const router = require('express').Router();
let Renderboard = require('../models/Renderboardmodel');

router.route('/').get((req, res) => {
    Renderboard.find()
      .then(render => {res.json(render)})
      .catch(err => res.status(400).json('Error: ' + err));
  });


router.route('/add').post( async (req, res) => {
    const name = req.body.name;
    const imageuser = req.body.imageuser;
    const iduser = req.body.iduser;
    const score = req.body.score
    const email = req.body.email
    
    try{ const user = await Renderboard.findOne({
      email :email
    }) 

    if(user == null){
        var datascore = {name: name, imageuser:imageuser, iduser:iduser, score:score,  email:email}
        await Renderboard.create(datascore)
        res.sendStatus(200)
  }else{
      var orgscore = await Renderboard.findOne({email:email})
      var total = orgscore.score + score
      console.log('total  =', orgscore.score, "+", score)
      await orgscore.updateOne({'iduser' : iduser, 'score' : total})
      .then(() => {console.log('update complete'); res.sendStatus(200)})
    }
  }catch(err){
    res.status(500).json(err.message)
  }
  
})

module.exports = router;
