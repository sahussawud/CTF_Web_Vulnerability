const router = require('express').Router();
let User = require('../models/UserModel');

router.route('/').get((req, res) => {
  User.find()
    .then(users => {res.json(users)})
    .catch(err => res.status(400).json('Error: ' + err));
});

router.route('/add').post( async (req, res) => {
  const name = req.body.name;
  const imageuser = req.body.imageuser;
  const iduser = req.body.iduser
  const email = req.body.email
  const question1 = false
  const question2 = false
  const question3 = false
  const question4 = false
  const question5 = false
  const question6 = false


 try{ const user = await User.findOne({
    email :email
  }) 

  if(!user){
    var data = {name: name, imageuser:imageuser, iduser:iduser, email:email, question1:question1,
      question2:question2,
      question3:question3,
      question4:question4,
      question5:question5,
      question6:question6
    
    }
      await User.create(data)
      res.sendStatus(200)
}else{
    await User.updateOne(
      {$set :{'iduser' : iduser}}
    )
    .then(() => {console.log('update complete'); res.sendStatus(200)})
    // .catch(() => console.log('error'))
  }
}catch(err){
  res.status(500).json({err})
}
});

router.route('/setstatus').post(async (req, res) => {
  const email = req.body.email
  const question1 = req.body.question1
  console.log('data status', email, question1)
  var questionuser = await User.findOne({email:email})
  await questionuser.updateOne({'question1': question1})
  .then((res) => res.sendStatus(200))
  .catch((er) => res.json(er))

});


module.exports = router;
