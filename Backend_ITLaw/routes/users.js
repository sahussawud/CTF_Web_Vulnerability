const router = require('express').Router();
let User = require('../models/UserModel');

router.route('/').get((req, res) => {
  User.find()
    .then(users => {res.json(users)})
    .catch(err => res.status(400).json('Error: ' + err));
});

router.route('/add').post( async (req, res) => {
  const name = req.body.name;
  const imageuser = req.body.imageuser;
  const iduser = req.body.iduser
  const email = req.body.email

 try{ const user = await User.findOne({
    email :email
  }) 

  if(!user){
    var data = {name: name, imageuser:imageuser, iduser:iduser, email:email}
      await User.create(data)
      res.sendStatus(200)
}else{
    await User.updateOne(
      {$set :{'iduser' : iduser}}
    )
    .then(() => {console.log('update complete'); res.sendStatus(200)})
    // .catch(() => console.log('error'))
  }
}catch(err){
  res.status(500).json({err})
}


});

module.exports = router;
