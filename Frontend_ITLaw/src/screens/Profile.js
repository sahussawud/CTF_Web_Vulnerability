import React, { useState, useEffect } from "react";
import "../App.css";
import Navbar from "./navbar";
import Navbarlogedin from "./navbarlogedin";
import { Carousel } from "react-bootstrap";
import axios from "axios";


const Profile = () => {
  const [token, setTokenken] = useState("");
  const [nameUser,  setNameuser] = useState('')
  const [imaguser, setImaguser] = useState('')
  const [arrauUser, setUser] = useState([])
  const [testArray, setArray] = useState([])

  const getToken = async () => {
    var token = await localStorage.getItem("token");
    console.log(token)
    const iduser = {
      'iduser' : token
    }
    
    try {
      await axios.post("https://serveritlaw.herokuapp.com/users/getdatauser", iduser)
      .then(async (res) => {
        console.log(res.data)
        if(res.status == 200){
          setImaguser(res.data.iamgeuser)
          setNameuser(res.data.name)
          await setUser(res.data)
          await setArray(res.data.dataanswer)
        }
      })
      .catch((er) => console.log(er.message))
    }catch{

    }
  };
   const number1 = () => {

    if(testArray!= null){
      const result = testArray.find(ques => ques.namequestion == 'API Hacking')
      if(result != undefined){
        return ( <td className="h5"> {result.count} </td>)
      }else{
        return ( <td className="h5">0</td>)
      }
    }
    else{
      return(
         <td className="h5">0 </td>
      )
    }
  }


  const number2 = () => {  
    if(testArray!= null){
      const result = testArray.find(ques => ques.namequestion == 'Admin’s noten')
      if(result != undefined){
        return ( <td className="h5"> {result.count} </td>)
      }else{
        return ( <td className="h5"> 0 </td>)
      }
    }
    else{
      return(
         <td className="h5"> 0 </td>
      )
    }
  }

  const number3 = () => {
    if(testArray!= null){
      const result = testArray.find(ques => ques.namequestion == 'Cookies Attack')
      if(result != undefined){
        return ( <td className="h5"> {result.count} </td>)
      }else{
        return ( <td className="h5"> 0 </td>)
      }
    }
    else{
      return(
         <td className="h5"> 0 </td>
      )
    }
  }

  const number4 = () => {
    if(testArray!= null){
      const result = testArray.find(ques => ques.namequestion == 'Token Is Have Something Wrong?')
      if(result != undefined){
        return ( <td className="h5" style={{textAlign:'center'}}> {result.count} </td>)
      }else{
        return ( <td className="h5" style={{textAlign:'center'}}> 0 </td>)
      } 
    }
    else{
      return(
         <td className="h5" style={{textAlign:'center'}}> 0 </td>
      )
    }
  }
  

  useEffect(async () => {
    await getToken();
  }, [token]);

  const Logout = () => {
    localStorage.clear();
    window.location.reload();
  };


  return (
    <div>
      <div id="bg-profile" />
      <div class="wrapper" style={{ marginTop: 90 }}>
        <div class="profile-card js-profile-card">
          <div class="profile-card__img">
            <img
              src={imaguser}
            />
          </div>

          <div class="profile-card__cnt js-profile-cnt">
            <div class="profile-card__name font-mitr h2">
              {nameUser}
            </div>

            <div class="profile-card-inf font-mitr">
              <table class="table">
                <thead>
                  <tr>
                    <th className="h4">รูปภาพประกอบ</th>
                    <th className="h4">ข้อ</th>
                    <th className="h4">ครั้งที่</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td scope="row">
                      <img
                        style={{ borderRadius: 5 }}
                        src="https://i.ytimg.com/vi/Fa1zlLEGPtw/maxresdefault.jpg"
                        height="100"
                        width="200"
                      />
                    </td>
                    <td className="h5" >API Hacking</td>
                    {number1()}
                  </tr>
                  <tr>
                    <td scope="row">
                      <img
                        style={{ borderRadius: 5 }}
                        src="https://dpsvdv74uwwos.cloudfront.net/statics/img/blogposts/no-sql-injection.png"
                        height="100"
                        width="200"
                      />
                    </td>
                    <td className="h5">Admin's note</td>
                    {number2()}
                  </tr>
                  {/* <tr>
                    <td scope="row">
                      <img
                        style={{ borderRadius: 5 }}
                        src="https://dpsvdv74uwwos.cloudfront.net/statics/img/blogposts/no-sql-injection.png"
                        height="100"
                        width="200"
                      />
                    </td>
                    <td className="h5">Admin's note</td>
                    {number2()}
                  </tr> */}
                  <tr>
                    <td scope="row">
                      <img
                        style={{ borderRadius: 5 }}
                        src="https://i.pinimg.com/originals/2b/99/10/2b9910aa6732cd292bc9127195b96671.jpg"
                        height="100"
                        width="200"
                      />
                    </td>
                    <td className="h5" style={{textAlign:'center'}}>Cookies Attack</td>
                    {number3()}
                  </tr>
                  <tr>
                    <td scope="row">
                      <img
                        style={{ borderRadius: 5 }}
                        src="https://storage.googleapis.com/techsauce-prod/uploads/2019/04/Cyber-security.jpg"
                        height="100"
                        width="200"
                      />
                    </td>
                    <td className="h5" style={{textAlign:'center'}}>Token Is Have Something Wrong?</td>
                    {number4()}
                  </tr>
                </tbody>
              </table>
            </div>

            <div class="profile-card-ctr">
              <button
                class="profile-card__button button--orange"
                onClick={Logout}
              >
                Logout
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  );
};
export default Profile;
